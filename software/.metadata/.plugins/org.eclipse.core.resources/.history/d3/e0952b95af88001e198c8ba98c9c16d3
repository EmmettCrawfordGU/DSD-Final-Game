#include <sys/alt_stdio.h>
#include "system.h"
#include "altera_avalon_pio_regs.h"
#include <stdint.h>
#include <stdlib.h>


#define SEVEN_SEG_1 0x0000008F
#define SEVEN_SEG_2 0x00000012
#define SEVEN_SEG_3 0x00000006
#define SEVEN_SEG_4 0x0000008C

int main(){
	uint8_t switch_data;
	int delay;
	int led_pattern=0x0;
	char data[8];
	uint32_t hex_data = 0xFFFFFF99; // 0011001
	//hex_data |= (SEVEN_SEG_1 << 21);
	//hex_data |= (SEVEN_SEG_2 << 14);
	//hex_data |= (SEVEN_SEG_3 << 7);
	//hex_data &= ~(SEVEN_SEG_4);

	alt_putstr("Ciao from Nios II!\n");

	while(1) {
		switch_data = IORD_ALTERA_AVALON_PIO_DATA(SWITCH_BASE);
		alt_putstr("Switch Data: ");
		alt_putstr(itoa(switch_data, data, 2));
		alt_putstr("\n");
		IOWR_ALTERA_AVALON_PIO_DATA(LEDS_BASE, led_pattern);
		IOWR_ALTERA_AVALON_PIO_DATA(HEX_BASE, hex_data);

		delay = 0;
		while(delay < 200000) {
			delay++;
		}
		led_pattern ^= 0x0F; // toggle LEDs on selected switches
	}

	return 0;
}
