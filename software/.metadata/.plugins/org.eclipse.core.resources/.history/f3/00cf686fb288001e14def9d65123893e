#include <sys/alt_stdio.h>
#include "system.h"
#include "altera_avalon_pio_regs.h"
#include <stdint.h>
#include <stdlib.h>


#define SEVEN_SEG_1 0xFFFFFFF9 // 111...1111001
#define SEVEN_SEG_2 0xFFFFFFA4 // 111...0100100
#define SEVEN_SEG_3 0xFFFFFFB0 // 111...0110000
#define SEVEN_SEG_4 0xFFFFFF99 // 111...0011001

int main(){
	uint8_t switch_data;
	uint8_t key_data;
	int delay;
	int led_pattern=0x0;
	char data[8];
	uint32_t hex_data = 0xFFFFFFFF;
	hex_data &= SEVEN_SEG_1;
	hex_data = (((hex_data << 7) | 0x7F) & SEVEN_SEG_2);
	hex_data = (((hex_data << 7) | 0x7F) & SEVEN_SEG_3);
	hex_data = (((hex_data << 7) | 0x7F) & SEVEN_SEG_4);

	alt_putstr("Ciao from Nios II!\n");

	while(1) {
		switch_data = IORD_ALTERA_AVALON_PIO_DATA(SWITCH_BASE);
		key_data = IORD_ALTERA_AVALON_PIO_DATA(KEY_BASE);
		alt_putstr("Switch Data: ");
		alt_putstr(itoa(switch_data, data, 2));
		alt_putstr("\n");
		alt_putstr("Key Data: ");
		alt_putstr(itoa(key_data, data, 2));
		alt_putstr("\n");
		alt_putstr("\n");
		IOWR_ALTERA_AVALON_PIO_DATA(LEDS_BASE, led_pattern);
		IOWR_ALTERA_AVALON_PIO_DATA(HEX_BASE, hex_data);

		delay = 0;
		while(delay < 200000) {
			delay++;
		}
		led_pattern ^= 0x0F; // toggle LEDs on selected switches
	}

	return 0;
}
